#Part 1 Metagenomics 

#Step 1 download samples 
#download samples from: https://www.ncbi.nlm.nih.gov/bioproject/PRJNA1119528 
#I used sample 1, 26, and 55

#Step 2 make new directories for project and upload samples to cluster 
mkdir final_proj 
cd final_proj/
mkdir sample_1 
cd sample_1 
mkdir fastqc
mkdir kraken 
mkdir humann2
#use filezilla to upload sample 1 fastq file into ~/final_proj/sample_1/fastqc

#step 3 run fastqc to assess quality of sample 
cd fastqc
module load fastqc/0.12.1
gunzip SRR29267809.fastq 
fastqc SRR29267809.fastq 
#use filezilla to tranfer output file and open to see report 

#step 4 run kraken on sample for taxonomy report file 
cd ..
cd kraken 
cp /home/FCAM/mcb5631/classFiles/kraken_SMCA24.sh . 
nano kraken_SMCA24.sh 
#change email 
#change file used to SRR29267809.fastq 
#delete zip file command since not a zipped file 
#delete mpa style command to make output compatible for krona 
#save batch script under new name kraken_SMCA24_1.sh

#run batch script on head node
exit 
cd final_proj/sample_1/
sbatch kraken/kraken_SMCA24_1.sh 

#step 5 krona for taxonomic visualization (download KronaTools, update it, and run on kraken output file)
cd final_proj/sample_1/kraken
curl -LOk https://github.com/marbl/Krona/releases/download/v2.7/KronaTools-2.7.tar
tar -xvf KronaTools-2.7.tar
cd KronaTools-2.7
./install.pl --prefix /home/FCAM/mcb5631/usr28/final_proj/sample_1/kraken/KronaTools-2.7
./updateTaxonomy.sh
cd scripts/
./ImportTaxonomy.pl -t 5 -m 3 -o kraken_tr.krona.html /home/FCAM/mcb5631/usr28/final_proj/sample_1/kraken/kraken_report.txt
#use filezilla to view output file and look at taxonomy 


